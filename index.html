<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مصمم هياكل ديسكورد</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');
        :root { --bg: #0d1117; --primary: #161b22; --border: #30363d; --accent: #58a6ff; --text: #c9d1d9; --text-muted: #8b949e; --success: #3fb950; --danger: #f85149; }
        * { box-sizing: border-box; margin: 0; }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--bg); color: var(--text); display: grid; place-items: center; min-height: 100vh; padding: 1rem; }
        .container { display: grid; grid-template-columns: 1fr 1.5fr; gap: 2rem; width: 100%; max-width: 1000px; }
        .panel { background-color: var(--primary); border: 1px solid var(--border); border-radius: 8px; padding: 1.5rem; }
        h2 { margin-bottom: 1.5rem; }
        .form-group { margin-bottom: 1rem; }
        input, select { width: 100%; background-color: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 0.75rem; border-radius: 6px; font-size: 1rem; }
        .btn-group { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .btn { flex-grow: 1; padding: 0.75rem; border: 1px solid var(--border); background-color: var(--primary); color: var(--text); border-radius: 6px; cursor: pointer; transition: background-color 0.2s; }
        .btn:hover { background-color: var(--border); }
        .btn-main { background-color: var(--accent); color: var(--bg); border-color: var(--accent); font-weight: 700; margin-top: 1rem; width: 100%; font-size: 1.1rem; }
        .output-panel pre { background-color: var(--bg); padding: 1rem; border-radius: 6px; white-space: pre-wrap; word-wrap: break-word; max-height: 300px; overflow-y: auto; }
        .result-box { margin-top: 1.5rem; padding: 1rem; border-radius: 6px; text-align: center; font-size: 1.1rem; }
        .result-box.success { background-color: rgba(63, 185, 80, 0.2); border: 1px solid var(--success); color: var(--success); }
        .result-box.error { background-color: rgba(248, 81, 73, 0.2); border: 1px solid var(--danger); color: var(--danger); }
        .result-box .code { font-weight: 700; background: var(--bg); padding: 0.2rem 0.5rem; border-radius: 4px; }
        @media (max-width: 768px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel input-panel">
            <h2>1. صمم هيكلك</h2>
            <div class="form-group">
                <input type="text" id="itemName" placeholder="اسم الفئة أو القناة">
            </div>
            <div class="btn-group">
                <button class="btn" id="addCategoryBtn">➕ فئة</button>
                <button class="btn" id="addTextBtn"># كتابي</button>
                <button class="btn" id="addVoiceBtn">🔊 صوتي</button>
            </div>
            <div class="form-group">
                <select id="categorySelect">
                    <option value="">-- اختر فئة للقناة --</option>
                </select>
            </div>
        </div>
        <div class="panel output-panel">
            <h2>2. الهيكل (JSON)</h2>
            <pre id="outputJson">[]</pre>
            <button class="btn btn-main" id="generateCodeBtn">3. إنشاء الكود</button>
            <div id="resultDisplay"></div>
        </div>
    </div>

    <script>
        const itemNameInput = document.getElementById('itemName');
        const addCategoryBtn = document.getElementById('addCategoryBtn');
        const addTextBtn = document.getElementById('addTextBtn');
        const addVoiceBtn = document.getElementById('addVoiceBtn');
        const categorySelect = document.getElementById('categorySelect');
        const outputJson = document.getElementById('outputJson');
        const generateCodeBtn = document.getElementById('generateCodeBtn');
        const resultDisplay = document.getElementById('resultDisplay');

        // رابط الواجهة الخلفية - عدله إذا لزم الأمر
        const BACKEND_URL = 'http://fi11.bot-hosting.net:20856';

        let serverStructure = [];

        const updateUI = () => {
            outputJson.textContent = JSON.stringify(serverStructure, null, 2);
            const categories = serverStructure.filter(item => item.type === 'category');
            categorySelect.innerHTML = '<option value="">-- اختر فئة للقناة --</option>';
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.name;
                option.textContent = cat.name;
                categorySelect.appendChild(option);
            });
        };

        addCategoryBtn.addEventListener('click', () => {
            const name = itemNameInput.value.trim();
            if (!name) return alert('يرجى إدخال اسم للفئة.');
            serverStructure.push({ type: 'category', name });
            itemNameInput.value = '';
            updateUI();
        });

        const addChannel = (type) => {
            const name = itemNameInput.value.trim();
            const parent = categorySelect.value;
            if (!name) return alert('يرجى إدخال اسم للقناة.');
            if (!parent) return alert('يرجى اختيار فئة أولاً.');
            serverStructure.push({ type, name, parent });
            itemNameInput.value = '';
            updateUI();
        };

        addTextBtn.addEventListener('click', () => addChannel('text'));
        addVoiceBtn.addEventListener('click', () => addChannel('voice'));

        generateCodeBtn.addEventListener('click', async () => {
            if (serverStructure.length === 0) return alert('الهيكل فارغ! أضف بعض الفئات والقنوات أولاً.');
            generateCodeBtn.disabled = true;
            generateCodeBtn.textContent = 'جاري الإنشاء...';
            resultDisplay.innerHTML = '';

            try {
                const response = await fetch(`${BACKEND_URL}/api/generate-code`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(serverStructure)
                });
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'فشل في إنشاء الكود.');

                resultDisplay.className = 'result-box success';
                resultDisplay.innerHTML = `
                    <p>✅ تم إنشاء الكود بنجاح!</p>
                    <p>أضف البوت إلى سيرفرك ثم اكتب:</p>
                    <p><code>!start <span class="code">${data.code}</span></code></p>
                    <small>الكود صالح لمدة 3 ساعات.</small>
                `;
            } catch (error) {
                resultDisplay.className = 'result-box error';
                resultDisplay.innerHTML = `<p>❌ خطأ: ${error.message}</p>`;
            } finally {
                generateCodeBtn.disabled = false;
                generateCodeBtn.textContent = '3. إنشاء الكود';
            }
        });
    </script>
</body>
</html>
